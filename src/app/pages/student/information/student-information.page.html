<div class="page">
  <app-header></app-header>

  <div class="page-elements">
    <div class="page-left-menu" app-student-menu [studentId]="student.id" [currentTab]="'INFORMATION'"></div>

    <div class="page-content-with-footer">
      <div *ngIf="loadingInProgress" class="page-loading">
        <fa name="spinner" animation="spin"></fa>
      </div>

      <ng-container *ngIf="!loadingInProgress">
        <h3 class="app-header" *ngIf="!!student.id">
          {{student.name}} - Редактирование
        </h3>

        <h3 class="app-header" *ngIf="!student.id">
          Добавление информации об ученика
        </h3>

        <br>

        <form>
          <div app-form-text-input-control class="form-group"
               [name]="'name'"
               [label]="'Имя'"
               [placeholder]="'Введите имя'"
               [valid]="!!student.name && student.name.indexOf('?') === -1"
               [value]="student.name"
               [editable]="true"
               (onChange)="student.name = $event"></div>

          <div app-form-tag-control class="form-group"
               [name]="'telephones'"
               [label]="'Телефоны'"
               [placeholder]="'Введите телефон'"
               [valid]="hasAtLeastOneContact()"
               [value]="student.phones"
               (onChange)="student.phones = $event"></div>

          <div class="student-vkLink-container">
            <div app-form-text-input-control class="form-group student-vkLink"
                 [name]="'vkLink'"
                 [label]="'Ссылка VK'"
                 [placeholder]="'Введите ссылку'"
                 [valid]="hasAtLeastOneContact()"
                 [value]="student.vkLink"
                 [editable]="true"
                 (onChange)="student.vkLink = $event"></div>

            <button class="btn btn-primary student-vkLink-action" [disabled]="!student.vkLink" (click)="goToVk()">Перейти</button>
          </div>

          <div app-form-select-control class="form-group"
               [name]="'educationLevel'"
               [label]="'Уровень подготовки'"
               [valid]="student.educationLevel !== 'UNKNOWN'"
               [valueString]="student.educationLevel"
               [items]="educationLevelItems"
               (onChangeString)="student.educationLevel = $event"></div>

          <div app-form-select-control class="form-group"
               [name]="'age'"
               [label]="'Возраст'"
               [valid]="student.age !== 'UNKNOWN'"
               [valueString]="student.age"
               [items]="ageItems"
               (onChangeString)="student.age = $event"></div>

          <div class="form-group" *ngIf="!!student.id">
            <label class="app-label h-full">Статус:</label>

            <div class="student-status-container">
              <div class="student-status" app-student-status [studentStatusType]="student.statusType"></div>

              <button class="btn btn-primary student-status-action" (click)="goToStatus()">Изменить статус</button>
            </div>
          </div>

          <div class="form-group">
            <label class="app-label h-full">
              Группы:
            </label>

            <div class="app-text" *ngIf="student.studentGroups.length === 0">
              Студент не назначен в группу
            </div>

            <div *ngFor="let studentGroup of student.studentGroups; let i = index" class="student-group-container">
              <div app-form-select-control class="form-group student-group"
                   [name]="'studentGroup_' + i"
                   [valueNumber]="studentGroup.groupId"
                   [items]="getMatchingGroups()"
                   (onChangeNumber)="studentGroup.groupId = $event"></div>

              <div class="student-group-info app-text">
                <ng-container *ngIf="!studentGroup.startTime">
                  Новая группа
                </ng-container>
                <ng-container *ngIf="!!studentGroup.startTime && !studentGroup.finishTime">
                  с {{studentGroup.startTime | date: 'dd.MM.yyyy'}}
                </ng-container>
                <ng-container *ngIf="!!studentGroup.startTime && !!studentGroup.finishTime">
                  с {{studentGroup.startTime | date: 'dd.MM.yyyy'}} по {{studentGroup.finishTime | date: 'dd.MM.yyyy'}}
                </ng-container>
              </div>

              <div
                *ngIf="!!studentGroup.startTime && !studentGroup.finishTime"
                class="student-group-action"
                (click)="disableGroup(i)">
                Отключить
              </div>

              <div
                *ngIf="!!studentGroup.startTime && !!studentGroup.finishTime"
                class="student-group-action"
                (click)="enableGroup(i)">
                Включить
              </div>

              <div
                class="student-group-action"
                (click)="removeGroup(i)">
                Удалить
              </div>

              <div
                *ngIf="!!student.studentGroups[i]"
                class="student-group-action"
                (click)="goToGroup(student.studentGroups[i].groupId)">
                Перейти
              </div>
            </div>
          </div>

          <button class="btn btn-secondary" (click)="addGroup()">Добавить группу</button>

          <br>
        </form>
      </ng-container>
    </div>

    <div class="page-right-menu">
    </div>
  </div>

  <div class="footer">
    <button [disabled]="!student.id" class="btn btn-danger pull-right horizontal-item" (click)="delete()">
      Удалить
    </button>

    <button class="btn btn-primary pull-right" (click)="save()">
      Сохранить
    </button>
  </div>
</div>
